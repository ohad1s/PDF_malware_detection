import joblib
import pandas as pd

from Feature_Extractor import Feature_Extractor
cols = ['FileName', 'PDFSize', 'MetadataSize', 'Pages', 'XrefLength', 'TitleCharacters',
                'IsEncrypted', 'EmbeddedFiles', 'Images', 'Text', 'Header', 'Obj',
                'EndObj', 'Stream', 'EndStream', 'Xref', 'Trailer', 'StartXref', 'PageNo', 'Encrypt',
                'ObjStm', 'JS', 'Javascript', 'AA', 'OpenAction', 'Acroform', 'JBIG2Decode', 'RichMedia',
                'Launch', 'EmbeddedFile', 'XFA', 'Colors']


class Run_Model():

    def __init__(self, file_path):
        self.file_path=file_path
        self.model=joblib.load('random_forest.pkl')

    def load_features(self):
        feature_extractor=Feature_Extractor(self.file_path)
        self.features_list= feature_extractor.main()
        self.df = pd.DataFrame([self.features_list],columns=cols)
        print(self.df)

    def main(self):
        self.load_features()
        print(self.features_list)
        X = self.df.drop('FileName', axis=1)
        X = X.drop('Header', axis=1)
        prediction= self.model.predict(X)
        print("Predicted as: ",prediction)

rm= Run_Model("pdfs/JavaScriptClock.pdf")
rm.main()
print("---------------------------------")
rm2= Run_Model("pdfs/dummy.pdf")
rm2.main()
print("---------------------------------")
rm3= Run_Model(r"C:\Users\shira\Desktop\CV_Ohad_Shirazi_merged.pdf")
rm3.main()
print("---------------------------------")
rm4= Run_Model(r"C:\Users\shira\Desktop\simple_memo.pdf")
rm4.main()
